<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Applied Data Science Course 1 - 10&nbsp; Pivot tables</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../code/10_date_and_time.html" rel="next">
<link href="../code/8_scales.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-sidebar floating">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Pivot tables</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Applied Data Science Course 1</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to Data Science in Python</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../code/1_intro.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction into python</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../code/2_numpy.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Numpy</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../code/3_regular_expressions.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Regex</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../code/4_pandas.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Pandas</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../code/5_pandas2.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Data processing with pandas</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../code/6_idioms.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Panda idioms</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../code/7_groupby.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Grouping data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../code/8_scales.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Scales</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../code/9_pivot.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Pivot tables</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../code/10_date_and_time.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Dates and times</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Pivot tables</span></h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<p>A pivot table is a way of summarizing data in a DataFrame for a particular purpose. It makes heavy use of the aggregation function.</p>
<p>A pivot table is itself a DataFrame, where the rows represent one variable that you’re interested in, the columns another, and the cell’s some aggregate value. A pivot table also tends to includes marginal values as well, which are the sums for each column and row. This allows you to be able to see the relationship between two variables at just a glance.</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we have the Times Higher Education World University Ranking dataset, which is one of the most influential university measures. Let’s import the dataset and see what it looks like:</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'../data/week3/cwurData.csv'</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>world_rank</th>
      <th>institution</th>
      <th>country</th>
      <th>national_rank</th>
      <th>quality_of_education</th>
      <th>alumni_employment</th>
      <th>quality_of_faculty</th>
      <th>publications</th>
      <th>influence</th>
      <th>citations</th>
      <th>broad_impact</th>
      <th>patents</th>
      <th>score</th>
      <th>year</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Harvard University</td>
      <td>USA</td>
      <td>1</td>
      <td>7</td>
      <td>9</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>NaN</td>
      <td>5</td>
      <td>100.00</td>
      <td>2012</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>Massachusetts Institute of Technology</td>
      <td>USA</td>
      <td>2</td>
      <td>9</td>
      <td>17</td>
      <td>3</td>
      <td>12</td>
      <td>4</td>
      <td>4</td>
      <td>NaN</td>
      <td>1</td>
      <td>91.67</td>
      <td>2012</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Stanford University</td>
      <td>USA</td>
      <td>3</td>
      <td>17</td>
      <td>11</td>
      <td>5</td>
      <td>4</td>
      <td>2</td>
      <td>2</td>
      <td>NaN</td>
      <td>15</td>
      <td>89.50</td>
      <td>2012</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>University of Cambridge</td>
      <td>United Kingdom</td>
      <td>1</td>
      <td>10</td>
      <td>24</td>
      <td>4</td>
      <td>16</td>
      <td>16</td>
      <td>11</td>
      <td>NaN</td>
      <td>50</td>
      <td>86.17</td>
      <td>2012</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>California Institute of Technology</td>
      <td>USA</td>
      <td>4</td>
      <td>2</td>
      <td>29</td>
      <td>7</td>
      <td>37</td>
      <td>22</td>
      <td>22</td>
      <td>NaN</td>
      <td>18</td>
      <td>85.21</td>
      <td>2012</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Here we can see each institution’s rank, country, quality of education, other metrics, and overall score.</p>
<p>Let’s say we want to create a new column called Rank_Level, where institutions with world ranking 1-100 are categorized as first tier and those with world ranking 101 - 200 are second tier, ranking 201 - 300 are third tier, after 301 is other top universities.</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#define ranking fct</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_category(ranking):</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (ranking <span class="op">&gt;=</span> <span class="dv">1</span>) <span class="op">&amp;</span> (ranking <span class="op">&lt;=</span><span class="dv">100</span>):</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"First tier"</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> (ranking <span class="op">&gt;=</span> <span class="dv">101</span>) <span class="op">&amp;</span> (ranking <span class="op">&lt;=</span><span class="dv">200</span>):</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"Second tier"</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> (ranking <span class="op">&gt;=</span> <span class="dv">201</span>) <span class="op">&amp;</span> (ranking <span class="op">&lt;=</span><span class="dv">300</span>):</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span>(<span class="st">'Third tier'</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"Other Uni"</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co">#apply function</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Rank_Level'</span>] <span class="op">=</span> df[<span class="st">'world_rank'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: create_category(x))</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co">#view data</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>world_rank</th>
      <th>institution</th>
      <th>country</th>
      <th>national_rank</th>
      <th>quality_of_education</th>
      <th>alumni_employment</th>
      <th>quality_of_faculty</th>
      <th>publications</th>
      <th>influence</th>
      <th>citations</th>
      <th>broad_impact</th>
      <th>patents</th>
      <th>score</th>
      <th>year</th>
      <th>Rank_Level</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Harvard University</td>
      <td>USA</td>
      <td>1</td>
      <td>7</td>
      <td>9</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>NaN</td>
      <td>5</td>
      <td>100.00</td>
      <td>2012</td>
      <td>First tier</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>Massachusetts Institute of Technology</td>
      <td>USA</td>
      <td>2</td>
      <td>9</td>
      <td>17</td>
      <td>3</td>
      <td>12</td>
      <td>4</td>
      <td>4</td>
      <td>NaN</td>
      <td>1</td>
      <td>91.67</td>
      <td>2012</td>
      <td>First tier</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Stanford University</td>
      <td>USA</td>
      <td>3</td>
      <td>17</td>
      <td>11</td>
      <td>5</td>
      <td>4</td>
      <td>2</td>
      <td>2</td>
      <td>NaN</td>
      <td>15</td>
      <td>89.50</td>
      <td>2012</td>
      <td>First tier</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>University of Cambridge</td>
      <td>United Kingdom</td>
      <td>1</td>
      <td>10</td>
      <td>24</td>
      <td>4</td>
      <td>16</td>
      <td>16</td>
      <td>11</td>
      <td>NaN</td>
      <td>50</td>
      <td>86.17</td>
      <td>2012</td>
      <td>First tier</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>California Institute of Technology</td>
      <td>USA</td>
      <td>4</td>
      <td>2</td>
      <td>29</td>
      <td>7</td>
      <td>37</td>
      <td>22</td>
      <td>22</td>
      <td>NaN</td>
      <td>18</td>
      <td>85.21</td>
      <td>2012</td>
      <td>First tier</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>A pivot table allows us to pivot out one of these columns a new column headers and compare it against another column as row indices. Let’s say we want to compare rank level versus country of the universities and we want to compare in terms of overall score</p>
<p>To do this, we tell Pandas we want the values to be Score, and index to be the country and the columns to be the rank levels. Then we specify that the aggregation function, and here we’ll use the NumPy mean to get the average rating for universities in that country:</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df.pivot_table(values<span class="op">=</span><span class="st">'score'</span>, index<span class="op">=</span><span class="st">'country'</span>, columns<span class="op">=</span><span class="st">'Rank_Level'</span>, aggfunc <span class="op">=</span> [np.mean]).head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th colspan="4" halign="left">mean</th>
    </tr>
    <tr>
      <th>Rank_Level</th>
      <th>First tier</th>
      <th>Other Uni</th>
      <th>Second tier</th>
      <th>Third tier</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Argentina</th>
      <td>NaN</td>
      <td>44.672857</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Australia</th>
      <td>47.9425</td>
      <td>44.645750</td>
      <td>49.2425</td>
      <td>47.285000</td>
    </tr>
    <tr>
      <th>Austria</th>
      <td>NaN</td>
      <td>44.864286</td>
      <td>NaN</td>
      <td>47.066667</td>
    </tr>
    <tr>
      <th>Belgium</th>
      <td>51.8750</td>
      <td>45.081000</td>
      <td>49.0840</td>
      <td>46.746667</td>
    </tr>
    <tr>
      <th>Brazil</th>
      <td>NaN</td>
      <td>44.499706</td>
      <td>49.5650</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>We can see a hierarchical dataframe where the index, or rows, are by country and the columns have two levels, the top level indicating that the mean value is being used and the second level being our ranks. In this example we only have one variable, the mean, that we are looking at, so we don’t really need a hierarchical index.</p>
<p>We notice that there are some NaN values, for example, the first row, Argentia. The NaN values indicate that Argentia has only observations in the “Other Top Universities” category.</p>
<p>Now, pivot tables aren’t limited to one function that you might want to apply. You can pass a named parameter, aggfunc, which is a list of the different functions to apply, and pandas will provide you with the result using hierarchical column names. Let’s try that same query, but pass in the max() function too:</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>df.pivot_table(values<span class="op">=</span><span class="st">'score'</span>, index<span class="op">=</span><span class="st">'country'</span>, columns<span class="op">=</span><span class="st">'Rank_Level'</span>, aggfunc <span class="op">=</span> [np.mean, np.<span class="bu">max</span>]).head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th colspan="4" halign="left">mean</th>
      <th colspan="4" halign="left">amax</th>
    </tr>
    <tr>
      <th>Rank_Level</th>
      <th>First tier</th>
      <th>Other Uni</th>
      <th>Second tier</th>
      <th>Third tier</th>
      <th>First tier</th>
      <th>Other Uni</th>
      <th>Second tier</th>
      <th>Third tier</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Argentina</th>
      <td>NaN</td>
      <td>44.672857</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>45.66</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Australia</th>
      <td>47.9425</td>
      <td>44.645750</td>
      <td>49.2425</td>
      <td>47.285000</td>
      <td>51.61</td>
      <td>45.97</td>
      <td>50.40</td>
      <td>47.47</td>
    </tr>
    <tr>
      <th>Austria</th>
      <td>NaN</td>
      <td>44.864286</td>
      <td>NaN</td>
      <td>47.066667</td>
      <td>NaN</td>
      <td>46.29</td>
      <td>NaN</td>
      <td>47.78</td>
    </tr>
    <tr>
      <th>Belgium</th>
      <td>51.8750</td>
      <td>45.081000</td>
      <td>49.0840</td>
      <td>46.746667</td>
      <td>52.03</td>
      <td>46.21</td>
      <td>49.73</td>
      <td>47.14</td>
    </tr>
    <tr>
      <th>Brazil</th>
      <td>NaN</td>
      <td>44.499706</td>
      <td>49.5650</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>46.08</td>
      <td>49.82</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>So now we see we have both the mean and the max.</p>
<p>As mentioned earlier, we can also summarize the values within a given top level column. For instance, if we want to see an overall average for the country for the mean and we want to see the max of the max, we can indicate that we want pandas to provide marginal values:</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df.pivot_table(values<span class="op">=</span><span class="st">'score'</span>, index<span class="op">=</span><span class="st">'country'</span>, columns<span class="op">=</span><span class="st">'Rank_Level'</span>, aggfunc<span class="op">=</span>[np.mean, np.<span class="bu">max</span>], margins<span class="op">=</span><span class="va">True</span>).head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th colspan="5" halign="left">mean</th>
      <th colspan="5" halign="left">amax</th>
    </tr>
    <tr>
      <th>Rank_Level</th>
      <th>First tier</th>
      <th>Other Uni</th>
      <th>Second tier</th>
      <th>Third tier</th>
      <th>All</th>
      <th>First tier</th>
      <th>Other Uni</th>
      <th>Second tier</th>
      <th>Third tier</th>
      <th>All</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Argentina</th>
      <td>NaN</td>
      <td>44.672857</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>44.672857</td>
      <td>NaN</td>
      <td>45.66</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>45.66</td>
    </tr>
    <tr>
      <th>Australia</th>
      <td>47.9425</td>
      <td>44.645750</td>
      <td>49.2425</td>
      <td>47.285000</td>
      <td>45.825517</td>
      <td>51.61</td>
      <td>45.97</td>
      <td>50.40</td>
      <td>47.47</td>
      <td>51.61</td>
    </tr>
    <tr>
      <th>Austria</th>
      <td>NaN</td>
      <td>44.864286</td>
      <td>NaN</td>
      <td>47.066667</td>
      <td>45.139583</td>
      <td>NaN</td>
      <td>46.29</td>
      <td>NaN</td>
      <td>47.78</td>
      <td>47.78</td>
    </tr>
    <tr>
      <th>Belgium</th>
      <td>51.8750</td>
      <td>45.081000</td>
      <td>49.0840</td>
      <td>46.746667</td>
      <td>47.011000</td>
      <td>52.03</td>
      <td>46.21</td>
      <td>49.73</td>
      <td>47.14</td>
      <td>52.03</td>
    </tr>
    <tr>
      <th>Brazil</th>
      <td>NaN</td>
      <td>44.499706</td>
      <td>49.5650</td>
      <td>NaN</td>
      <td>44.781111</td>
      <td>NaN</td>
      <td>46.08</td>
      <td>49.82</td>
      <td>NaN</td>
      <td>49.82</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>A pivot table is just a multi-level dataframe, and we can access series or cells in the dataframe in a similar way as we do so for a regular dataframe.</p>
<p>Let’s create a new dataframe from our previous example:</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>new_df<span class="op">=</span>df.pivot_table(values<span class="op">=</span><span class="st">'score'</span>, index<span class="op">=</span><span class="st">'country'</span>, columns<span class="op">=</span><span class="st">'Rank_Level'</span>, aggfunc<span class="op">=</span>[np.mean, np.<span class="bu">max</span>], margins<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Now let's look at the index</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(new_df.index)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># And let's look at the columns</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(new_df.columns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Index(['Argentina', 'Australia', 'Austria', 'Belgium', 'Brazil', 'Bulgaria',
       'Canada', 'Chile', 'China', 'Colombia', 'Croatia', 'Cyprus',
       'Czech Republic', 'Denmark', 'Egypt', 'Estonia', 'Finland', 'France',
       'Germany', 'Greece', 'Hong Kong', 'Hungary', 'Iceland', 'India', 'Iran',
       'Ireland', 'Israel', 'Italy', 'Japan', 'Lebanon', 'Lithuania',
       'Malaysia', 'Mexico', 'Netherlands', 'New Zealand', 'Norway', 'Poland',
       'Portugal', 'Puerto Rico', 'Romania', 'Russia', 'Saudi Arabia',
       'Serbia', 'Singapore', 'Slovak Republic', 'Slovenia', 'South Africa',
       'South Korea', 'Spain', 'Sweden', 'Switzerland', 'Taiwan', 'Thailand',
       'Turkey', 'USA', 'Uganda', 'United Arab Emirates', 'United Kingdom',
       'Uruguay', 'All'],
      dtype='object', name='country')
MultiIndex([('mean',  'First tier'),
            ('mean',   'Other Uni'),
            ('mean', 'Second tier'),
            ('mean',  'Third tier'),
            ('mean',         'All'),
            ('amax',  'First tier'),
            ('amax',   'Other Uni'),
            ('amax', 'Second tier'),
            ('amax',  'Third tier'),
            ('amax',         'All')],
           names=[None, 'Rank_Level'])</code></pre>
</div>
</div>
<p>We can see the columns are hierarchical. The top level column indices have two categories: mean and max, and the lower level column indices have four categories, which are the four rank levels.</p>
<p>How would we query this if we want to get the average scores of First Tier Top Unversity levels in each country? We would just need to make two dataframe projections, the first for the mean, then the second for the top tier:</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>new_df[<span class="st">'mean'</span>][<span class="st">'First tier'</span>].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>country
Argentina        NaN
Australia    47.9425
Austria          NaN
Belgium      51.8750
Brazil           NaN
Name: First tier, dtype: float64</code></pre>
</div>
</div>
<p>We can see that the output is a series object which we can confirm by printing the type. Remember that when you project a single column of values out of a DataFrame you get a series.</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(new_df[<span class="st">'mean'</span>][<span class="st">'First tier'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>pandas.core.series.Series</code></pre>
</div>
</div>
<p>What if we want to find the country that has the maximum average score on First Tier Top University level? We can use the <strong>idxmax()</strong> function.</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>new_df[<span class="st">'mean'</span>][<span class="st">'First tier'</span>].idxmax()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>'United Kingdom'</code></pre>
</div>
</div>
<p>Now, the idxmax() function isn’t special for pivot tables, it’s a built in function to the Series object.</p>
<p>We don’t have time to go over all pandas functions and attributes, and I want to encourage you to explore the API to learn more deeply what is available to you.</p>
<p>If you want to achieve a different shape of your pivot table, you can do so with the stack and unstack functions.</p>
<ul>
<li><strong>Stacking</strong> is pivoting the lowermost column index to become the innermost row index. - <strong>Unstacking</strong> is the inverse of stacking, pivoting the innermost row index to become the lowermost column index. An example will help make this clear</li>
</ul>
<p>Let’s look at our pivot table first to refresh what it looks like:</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>new_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th colspan="5" halign="left">mean</th>
      <th colspan="5" halign="left">amax</th>
    </tr>
    <tr>
      <th>Rank_Level</th>
      <th>First tier</th>
      <th>Other Uni</th>
      <th>Second tier</th>
      <th>Third tier</th>
      <th>All</th>
      <th>First tier</th>
      <th>Other Uni</th>
      <th>Second tier</th>
      <th>Third tier</th>
      <th>All</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Argentina</th>
      <td>NaN</td>
      <td>44.672857</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>44.672857</td>
      <td>NaN</td>
      <td>45.66</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>45.66</td>
    </tr>
    <tr>
      <th>Australia</th>
      <td>47.9425</td>
      <td>44.645750</td>
      <td>49.2425</td>
      <td>47.285000</td>
      <td>45.825517</td>
      <td>51.61</td>
      <td>45.97</td>
      <td>50.40</td>
      <td>47.47</td>
      <td>51.61</td>
    </tr>
    <tr>
      <th>Austria</th>
      <td>NaN</td>
      <td>44.864286</td>
      <td>NaN</td>
      <td>47.066667</td>
      <td>45.139583</td>
      <td>NaN</td>
      <td>46.29</td>
      <td>NaN</td>
      <td>47.78</td>
      <td>47.78</td>
    </tr>
    <tr>
      <th>Belgium</th>
      <td>51.8750</td>
      <td>45.081000</td>
      <td>49.0840</td>
      <td>46.746667</td>
      <td>47.011000</td>
      <td>52.03</td>
      <td>46.21</td>
      <td>49.73</td>
      <td>47.14</td>
      <td>52.03</td>
    </tr>
    <tr>
      <th>Brazil</th>
      <td>NaN</td>
      <td>44.499706</td>
      <td>49.5650</td>
      <td>NaN</td>
      <td>44.781111</td>
      <td>NaN</td>
      <td>46.08</td>
      <td>49.82</td>
      <td>NaN</td>
      <td>49.82</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Now let’s try stacking, this should move the lowermost column, so the tiers of the university rankings, to the inner most row:</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>new_df <span class="op">=</span> new_df.stack()</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>new_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th>mean</th>
      <th>amax</th>
    </tr>
    <tr>
      <th>country</th>
      <th>Rank_Level</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">Argentina</th>
      <th>Other Uni</th>
      <td>44.672857</td>
      <td>45.66</td>
    </tr>
    <tr>
      <th>All</th>
      <td>44.672857</td>
      <td>45.66</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">Australia</th>
      <th>First tier</th>
      <td>47.942500</td>
      <td>51.61</td>
    </tr>
    <tr>
      <th>Other Uni</th>
      <td>44.645750</td>
      <td>45.97</td>
    </tr>
    <tr>
      <th>Second tier</th>
      <td>49.242500</td>
      <td>50.40</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>In the original pivot table, rank levels are the lowermost column, after stacking, rank levels become the innermost index, appearing to the right after country.</p>
<p>Now let’s try unstacking:</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>new_df.unstack().head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th colspan="5" halign="left">mean</th>
      <th colspan="5" halign="left">amax</th>
    </tr>
    <tr>
      <th>Rank_Level</th>
      <th>First tier</th>
      <th>Other Uni</th>
      <th>Second tier</th>
      <th>Third tier</th>
      <th>All</th>
      <th>First tier</th>
      <th>Other Uni</th>
      <th>Second tier</th>
      <th>Third tier</th>
      <th>All</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>All</th>
      <td>58.350675</td>
      <td>44.738871</td>
      <td>49.06545</td>
      <td>46.843450</td>
      <td>47.798395</td>
      <td>100.00</td>
      <td>46.34</td>
      <td>51.29</td>
      <td>47.93</td>
      <td>100.00</td>
    </tr>
    <tr>
      <th>Argentina</th>
      <td>NaN</td>
      <td>44.672857</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>44.672857</td>
      <td>NaN</td>
      <td>45.66</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>45.66</td>
    </tr>
    <tr>
      <th>Australia</th>
      <td>47.942500</td>
      <td>44.645750</td>
      <td>49.24250</td>
      <td>47.285000</td>
      <td>45.825517</td>
      <td>51.61</td>
      <td>45.97</td>
      <td>50.40</td>
      <td>47.47</td>
      <td>51.61</td>
    </tr>
    <tr>
      <th>Austria</th>
      <td>NaN</td>
      <td>44.864286</td>
      <td>NaN</td>
      <td>47.066667</td>
      <td>45.139583</td>
      <td>NaN</td>
      <td>46.29</td>
      <td>NaN</td>
      <td>47.78</td>
      <td>47.78</td>
    </tr>
    <tr>
      <th>Belgium</th>
      <td>51.875000</td>
      <td>45.081000</td>
      <td>49.08400</td>
      <td>46.746667</td>
      <td>47.011000</td>
      <td>52.03</td>
      <td>46.21</td>
      <td>49.73</td>
      <td>47.14</td>
      <td>52.03</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>That seems to restore our dataframe to its original shape. What do you think would happen if we unstacked twice in a row?</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>new_df.unstack().unstack().head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>      Rank_Level  country  
mean  First tier  All          58.350675
                  Argentina          NaN
                  Australia    47.942500
                  Austria            NaN
                  Belgium      51.875000
dtype: float64</code></pre>
</div>
</div>
<p>We actually end up unstacking all the way to just a single column, so a series object is returned. This column is just a “value”, the meaning of which is denoted by the hierarchical index of operation, rank, and country.</p>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../code/8_scales.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Scales</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../code/10_date_and_time.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Dates and times</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>